# set Alacritty window title
function set_win_title() {
  echo -ne "\033]0; ${PWD/#$HOME/~} \007"
}
starship_precmd_user_func="set_win_title"

# paths
export PATH=$PATH:$HOME/.local/bin
export PATH=/home/richardfrost/.opencode/bin:$PATH # opencode

# --- MISE ---
eval "$(mise activate bash)"

# --- Starship Prompt ---
eval "$(starship init bash)"
export STARSHIP_CONFIG=~/.config/starship/starship.toml

# --- Editors & Environment ---
export EDITOR=nvim

# --- FZF ---
source /usr/share/doc/fzf/examples/key-bindings.bash
source "$HOME/.local/share/fzf/completion.bash"

source /usr/share/bash-completion/completions/fzf
source "$HOME/.turso/env"

# fzf configuration

export FZF_DEFAULT_COMMAND='rg --files --hidden --follow --glob "!.git/*"'
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
export FZF_CTRL_T_OPTS="--preview 'batcat --color=always --line-range :50 {}'"
export FZF_ALT_C_COMMAND="fd --type d --hidden --exclude .git"

# --- Aliases ---
alias ssh='ssh.exe' # Windows 1Password ssh.exe

alias ssh-add='ssh-add.exe' # Windows 1Password ssh.exe
alias cat='batcat'
alias ff='fzf'
alias ls='eza -l --group-directories-first --icons'

alias lsa='eza -la --group-directories-first --icons'

alias cm='chezmoi'
alias lg='lazygit'
alias c='opencode'

# --- Functions ---

# nvim with auto conversion of Windows paths
function n() {

  if [ -z "$1" ]; then
    # Open nvim if no path is given
    nvim
    return
  fi

  local file="$1"

  # Check if the path is Windows, otherwise just open
  if [[ "$file" == *"\\"* ]] || [[ "$file" =~ ^[A-Za-z]: ]]; then
    nvim "$(wslpath -u "$file")"
  else
    nvim "$file"

  fi
}

# yazi

function y() {
  local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
  command yazi "$@" --cwd-file="$tmp"
  IFS= read -r -d '' cwd <"$tmp"
  [ "$cwd" != "$PWD" ] && [ -d "$cwd" ] && builtin cd -- "$cwd"
  rm -f -- "$tmp"
}

# copy to Windows Clipboard
clip() {

  # Check if filename was provided
  if [ -z "$1" ]; then
    echo "Usage: copy <filename>"
    return 1
  fi

  # Check if file exists
  if [ ! -f "$1" ]; then

    echo "Error: File '$1' not found."
    return 1
  fi

  # Pipe the file content to the Windows clipboard
  batcat "$1" | clip.exe && echo "Copied '$1' to clipboard"
}

# initialise zoxide
eval "$(zoxide init --cmd cd bash)"
